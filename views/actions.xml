<odoo>
  <!-- Нүүр хуудас Action -->
  <record id="action_nuur_huudas" model="ir.actions.act_window">
    <field name="name">Нүүр Хуудас</field>
    <field name="res_model">mandal.helpdesk.nuur</field>
    <field name="view_mode">form</field>
  </record>

  <!-- Хийх Ажлууд Action -->
  <record id="action_hiih_ajluud" model="ir.actions.act_window">
    <field name="name">Хийх Ажлууд</field>
    <field name="res_model">mandal.helpdesk.ajil</field>
    <field name="view_mode">tree,form</field>
    <field name="domain">[('assigned_user_id', '=', uid)]</field>
    <field name="context">{'search_default_my_tasks': 1}</field>
  </record>

  <!-- Надад оноогдсон ажлууд Action -->
  <record id="action_my_assigned_tasks" model="ir.actions.act_window">
    <field name="name">Надад оноогдсон ажлууд</field>
    <field name="res_model">mandal.helpdesk.ajil</field>
    <field name="view_mode">tree,form</field>
    <field name="domain">[('assigned_user_id', '=', uid)]</field>
    <field name="context">{'search_default_assigned_to_me': 1}</field>
  </record>

  <!-- Миний хэлтсийн ажлууд Action -->
  <record id="action_my_department_tasks" model="ir.actions.act_window">
    <field name="name">Миний хэлтсийн ажлууд</field>
    <field name="res_model">mandal.helpdesk.ajil</field>
    <field name="view_mode">tree,form</field>
    <field name="context">{'search_default_my_department': 1}</field>
  </record>

  <!-- Миний үүсгэсэн ажлууд Action -->
  <record id="action_my_created_tasks" model="ir.actions.act_window">
    <field name="name">Миний үүсгэсэн ажлууд</field>
    <field name="res_model">mandal.helpdesk.ajil</field>
    <field name="view_mode">tree,form</field>
    <field name="domain">[('creator_user_id', '=', uid)]</field>
  </record>

  <!-- Ажил оноох Action (Захирал) -->
  <record id="action_ajil_onooh" model="ir.actions.act_window">
    <field name="name">Ажил оноох</field>
    <field name="res_model">mandal.helpdesk.ajil.onooh</field>
    <field name="view_mode">tree,form</field>
    <field name="context">{'search_default_draft': 1}</field>
  </record>

  <!-- Хүсэлтийн хуудас Action -->
  <record id="action_huseltiin_huudas" model="ir.actions.act_window">
    <field name="name">Хүсэлтийн хуудас</field>
    <field name="res_model">mandal.helpdesk.huselt</field>
    <field name="view_mode">tree,form</field>
  </record>

  <!-- ============ VIEW DEFINITIONS ============ -->

  <!-- Хүсэлт Tree View -->
  <record id="view_huselt_tree" model="ir.ui.view">
    <field name="name">mandal.helpdesk.huselt.tree</field>
    <field name="model">mandal.helpdesk.huselt</field>
    <field name="arch" type="xml">
      <tree string="Хүсэлтүүд">
        <field name="name" />
        <field name="user_id" />
        <field name="department_id" />
        <field name="sender_department_id" />
        <field name="target_department_id" />
        <field name="assigned_department_id" />
      </tree>
    </field>
  </record>

  <!-- Хүсэлт Form View -->
  <record id="view_huselt_form" model="ir.ui.view">
    <field name="name">mandal.helpdesk.huselt.form</field>
    <field name="model">mandal.helpdesk.huselt</field>
    <field name="arch" type="xml">
      <form string="Хүсэлт">
        <sheet>
          <group>
            <group>
              <field name="name" placeholder="Хүсэлтийн нэр" />
              <field name="user_id" readonly="1" />
              <field name="employee_id" readonly="1" />
              <field name="department_id" readonly="1" />
            </group>
            <group>
              <field name="target_department_id" placeholder="Илгээх хэлтэс" required="1" />
              <field name="sender_department_id" readonly="1" />
              <field name="assigned_department_id" readonly="1" />
              <field name="is_done" readonly="1" string="test" />
            </group>
          </group>
          <group>
            <!-- <field name="description" placeholder="Хүсэлтийн тайлбар..." /> -->
          </group>
        </sheet>
        <div class="oe_chatter">
          <field name="message_follower_ids" />
          <field name="message_ids" />
        </div>
      </form>
    </field>
  </record>

  <!-- Ажил оноох Tree View -->
  <record id="view_ajil_onooh_tree" model="ir.ui.view">
    <field name="name">mandal.helpdesk.ajil.onooh.tree</field>
    <field name="model">mandal.helpdesk.ajil.onooh</field>
    <field name="arch" type="xml">
      <tree string="Ажил оноох" decoration-info="state=='draft'" decoration-success="state=='done'"
        decoration-warning="state=='assigned'" decoration-primary="state=='in_progress'">
        <field name="name" />
        <field name="huselt_id" />
        <field name="department_id" />
        <field name="assigned_user_id" />
        <field name="state" widget="badge" decoration-info="state=='draft'"
          decoration-success="state=='done'" decoration-warning="state=='assigned'" />
        <field name="progress" widget="progressbar" />
        <field name="deadline" />
      </tree>
    </field>
  </record>

  <!-- Ажил оноох Form View -->
  <record id="view_ajil_onooh_form" model="ir.ui.view">
    <field name="name">mandal.helpdesk.ajil.onooh.form</field>
    <field name="model">mandal.helpdesk.ajil.onooh</field>
    <field name="arch" type="xml">
      <form string="Ажил оноох">
        <header>
          <button name="action_assign" string="Ажилтанд оноох" type="object" class="oe_highlight"
            invisible="state != 'draft'" />
          <button name="action_start" string="Эхлүүлэх" type="object" class="oe_highlight"
            invisible="state != 'assigned'" />
          <button name="action_done" string="Дуусгах" type="object" class="oe_highlight"
            invisible="state != 'in_progress'" />
          <button name="action_cancel" string="Цуцлах" type="object"
            invisible="state in ['done', 'cancel']" />
          <field name="state" widget="statusbar" statusbar_visible="draft,assigned,in_progress,done" />
        </header>
        <sheet>
          <group>
            <group>
              <!-- ALL FIELDS ARE EDITABLE IN DRAFT STATE -->
              <field name="name" readonly="state != 'draft'" />
              <field name="huselt_id" readonly="state != 'draft'" /> <!-- Related Request - NOW
              EDITABLE IN DRAFT -->
              <field name="department_id" readonly="state != 'draft'" /> <!-- Department - NOW
              EDITABLE IN DRAFT -->
              <field name="assigned_user_id" readonly="state != 'draft'" /> <!-- Responsible Employee
              - NOW EDITABLE IN DRAFT -->
            </group>
            <group>
              <!-- ALL FIELDS ARE EDITABLE IN DRAFT STATE -->
              <field name="creator_id" readonly="1" />
              <field name="deadline" readonly="state != 'draft'" />
              <field name="start_date" readonly="state != 'draft'" /> <!-- Start Date - NOW EDITABLE
              IN DRAFT -->
              <field name="end_date" readonly="state != 'draft'" /> <!-- End Date - NOW EDITABLE IN
              DRAFT -->
              <field name="progress" widget="progressbar"
                readonly="state not in ('in_progress', 'done')" />
              <field name="state" invisible="1" />
            </group>
          </group>
          <group>
            <field name="description" placeholder="Ажлын тайлбар..." readonly="state != 'draft'" />
          </group>
        </sheet>
        <div class="oe_chatter">
          <field name="message_follower_ids" />
          <field name="activity_ids" />
          <field name="message_ids" />
        </div>
      </form>
    </field>
  </record>

  <!-- Ажил оноох Search View -->
  <record id="view_ajil_onooh_search" model="ir.ui.view">
    <field name="name">mandal.helpdesk.ajil.onooh.search</field>
    <field name="model">mandal.helpdesk.ajil.onooh</field>
    <field name="arch" type="xml">
      <search>
        <field name="name" />
        <field name="assigned_user_id" />
        <field name="department_id" />
        <filter string="Ноорог" name="draft" domain="[('state','=','draft')]" />
        <filter string="Оноогдсон" name="assigned" domain="[('state','=','assigned')]" />
        <filter string="Явагдаж байна" name="in_progress" domain="[('state','=','in_progress')]" />
        <filter string="Дууссан" name="done" domain="[('state','=','done')]" />
        <group expand="0" string="Бүлэглэх">
          <filter string="Төлөв" name="group_by_state" context="{'group_by':'state'}" />
          <filter string="Хэлтэс" name="group_by_department" context="{'group_by':'department_id'}" />
          <filter string="Ажилтан" name="group_by_user" context="{'group_by':'assigned_user_id'}" />
        </group>
      </search>
    </field>
  </record>

  <!-- Ажил Tree View -->
  <record id="view_ajil_tree" model="ir.ui.view">
    <field name="name">mandal.helpdesk.ajil.tree</field>
    <field name="model">mandal.helpdesk.ajil</field>
    <field name="arch" type="xml">
      <tree string="Ажлууд" decoration-info="state=='draft'" decoration-success="state=='done'"
        decoration-warning="state=='assigned'" decoration-primary="state=='in_progress'">
        <field name="name" />
        <field name="assigned_user_id" />
        <field name="department_id" />
        <field name="state" widget="badge" decoration-info="state in ['draft','assigned']"
          decoration-success="state=='done'" decoration-warning="state=='in_progress'" />
        <field name="priority" widget="priority" />
        <field name="progress" widget="progressbar" />
        <field name="deadline" />
      </tree>
    </field>
  </record>

  <!-- Ажил Form View -->
  <record id="view_ajil_form" model="ir.ui.view">
    <field name="name">mandal.helpdesk.ajil.form</field>
    <field name="model">mandal.helpdesk.ajil</field>
    <field name="arch" type="xml">
      <form string="Ажил">
        <header>
          <button name="action_accept" string="Хүлээн авах" type="object" class="oe_highlight"
            invisible="state != 'draft'" />
          <button name="action_start" string="Эхлүүлэх" type="object" class="oe_highlight"
            invisible="state != 'assigned'" />
          <button name="action_done" string="Дуусгах" type="object" class="oe_highlight"
            invisible="state != 'in_progress'" />
          <button name="action_cancel" string="Цуцлах" type="object"
            invisible="state in ['done', 'cancel']" />
          <field name="state" widget="statusbar" statusbar_visible="draft,assigned,in_progress,done" />
        </header>
        <sheet>
          <div class="oe_title">
            <h1>
              <field name="name" placeholder="Ажлын нэр..." />
            </h1>
          </div>
          <group>
            <group>
              <field name="huselt_id" readonly="1" />
              <field name="assigned_user_id" readonly="1" />
              <field name="department_id" readonly="1" />
              <field name="creator_user_id" readonly="1" />
            </group>
            <group>
              <field name="priority" widget="priority" />
              <field name="deadline" />
              <field name="start_date" readonly="1" />
              <field name="end_date" readonly="1" />
              <field name="progress" widget="progressbar" />
            </group>
          </group>
          <notebook>
            <page string="Тайлбар">
              <field name="description" placeholder="Ажлын дэлгэрэнгүй тайлбар..." />
            </page>
          </notebook>
        </sheet>
        <div class="oe_chatter">
          <field name="message_follower_ids" />
          <field name="activity_ids" />
          <field name="message_ids" />
        </div>
      </form>
    </field>
  </record>

  <!-- Ажил Search View -->
  <record id="view_ajil_search" model="ir.ui.view">
    <field name="name">mandal.helpdesk.ajil.search</field>
    <field name="model">mandal.helpdesk.ajil</field>
    <field name="arch" type="xml">
      <search>
        <field name="name" />
        <field name="assigned_user_id" />
        <field name="department_id" />
        <filter string="Надад оноогдсон" name="assigned_to_me"
          domain="[('assigned_user_id','=',uid)]" />
        <filter string="Миний хэлтэс" name="my_department"
          domain="[('department_id.member_ids.user_id','=',uid)]" />
        <filter string="Миний үүсгэсэн" name="my_created" domain="[('creator_user_id','=',uid)]" />
        <separator />
        <filter string="Ноорог" name="draft" domain="[('state','=','draft')]" />
        <filter string="Хүн авсан" name="assigned" domain="[('state','=','assigned')]" />
        <filter string="Явагдаж байна" name="in_progress" domain="[('state','=','in_progress')]" />
        <filter string="Дууссан" name="done" domain="[('state','=','done')]" />
        <group expand="0" string="Бүлэглэх">
          <filter string="Төлөв" name="group_by_state" context="{'group_by':'state'}" />
          <filter string="Хэлтэс" name="group_by_department" context="{'group_by':'department_id'}" />
          <filter string="Ажилтан" name="group_by_assigned_user"
            context="{'group_by':'assigned_user_id'}" />
          <filter string="Анхаарал" name="group_by_priority" context="{'group_by':'priority'}" />
        </group>
      </search>
    </field>
  </record>

  <!-- Хүсэлт Domain Rule -->
  <record id="rule_huselt_my_department" model="ir.rule">
    <field name="name">Хүсэлт - өөрийн хэлтэс эсвэл үүсгэсэн</field>
    <field name="model_id" ref="model_mandal_helpdesk_huselt" />
    <field name="domain_force">
      ['|',
      ('assigned_department_id','in', user.employee_ids.mapped('department_id').ids),
      ('user_id','=',user.id)]
    </field>
    <field name="groups" eval="[(4, ref('base.group_user'))]" />
  </record>

  <!-- Ажил Domain Rule - Энгийн ажилчин (зөвхөн өөрт оноогдсон) -->
  <record id="rule_ajil_employee_own" model="ir.rule">
    <field name="name">Task - Employee (assigned only)</field>
    <field name="model_id" ref="model_mandal_helpdesk_ajil" />
    <field name="domain_force">
      [('assigned_user_id','=',user.id)]
    </field>
    <field name="groups" eval="[(4, ref('helpdesk.group_helpdesk_employee'))]" />
  </record>


  <!-- Ажил Domain Rule - Захирал (хэлтсийн бүх ажил) -->
  <record id="rule_ajil_boss_all" model="ir.rule">
    <field name="name">Ажил - Захирал (бүгд)</field>
    <field name="model_id" ref="model_mandal_helpdesk_ajil" />
    <field name="domain_force">[(1,'=',1)]</field>
    <field name="groups" eval="[(4, ref('helpdesk.group_helpdesk_boss'))]" />
  </record>

  <!-- Ажил оноох - Захирал харна -->
  <record id="rule_ajil_onooh_boss" model="ir.rule">
    <field name="name">Ажил оноох - Захирал</field>
    <field name="model_id" ref="model_mandal_helpdesk_ajil_onooh" />

    <!-- CREATE-д саад болохгүй -->
    <field name="domain_force">[(1,'=',1)]</field>

    <field name="groups" eval="[(4, ref('helpdesk.group_helpdesk_boss'))]" />

    <field name="perm_read" eval="1" />
    <field name="perm_write" eval="1" />
    <field name="perm_create" eval="1" />
    <field name="perm_unlink" eval="1" />
  </record>

  <!-- Ажил оноох - Ажилчин (зөвхөн өөртөө оноогдсон) -->
  <record id="rule_ajil_onooh_employee" model="ir.rule">
    <field name="name">Ажил оноох - Ажилчин (өөртөө оноогдсон)</field>
    <field name="model_id" ref="model_mandal_helpdesk_ajil_onooh" />

    <field name="domain_force">
      [('assigned_user_id','=',user.id)]
    </field>

    <field name="groups" eval="[(4, ref('helpdesk.group_helpdesk_employee'))]" />

    <field name="perm_read" eval="1" />
    <field name="perm_write" eval="0" />
    <field name="perm_create" eval="0" />
    <field name="perm_unlink" eval="0" />
  </record>


</odoo>